<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>リスク管理ダッシュボード</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Custom styles for enhanced aesthetics */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
    }
    .card {
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    .metric-box {
      background: linear-gradient(45deg, #6366f1, #8b5cf6);
      color: white;
      border-radius: 8px;
      padding: 1.25rem;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .metric-box::before {
      content: '';
      position: absolute;
      top: -20px;
      right: -20px;
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transform: rotate(25deg);
    }
    .chart-container {
      position: relative;
      height: 320px; /* Adjusted height for better chart visibility */
      width: 100%;
    }
    .risk-gauge-container {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto;
    }
    .gauge-bg {
      stroke: #e2e8f0;
      stroke-width: 10;
      fill: none;
    }
    .gauge-fill {
      stroke-width: 10;
      fill: none;
      stroke-linecap: round;
      transition: stroke-dasharray 0.8s ease-out, stroke 0.5s ease;
    }
    .text-gauge-value {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5rem;
      font-weight: bold;
    }
    .risk-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.25rem;
      border-radius: 9999px; /* Pill shape */
      font-weight: 600;
      animation: pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
    }
    .risk-high { background-color: #fef2f2; color: #ef4444; } /* Red for high risk */
    .risk-medium { background-color: #fffbeb; color: #f59e0b; } /* Orange for medium risk */
    .risk-low { background-color: #ecfdf5; color: #10b981; } /* Green for low risk */
    .risk-critical { background-color: #fee2e2; color: #dc2626; } /* Deeper red for critical */

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .grid-cols-3-lg {
        grid-template-columns: 1fr;
      }
      .grid-cols-2-md {
        grid-template-columns: 1fr;
      }
      .chart-container {
        height: 280px;
      }
      .metric-box {
        padding: 1rem;
      }
      .risk-gauge-container {
        width: 120px;
        height: 120px;
      }
      .text-gauge-value {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body class="p-6">

  <!-- Header Section -->
  <header class="mb-8 p-6 bg-gradient-to-r from-blue-700 to-indigo-800 text-white rounded-xl shadow-lg flex items-center justify-between">
    <div class="flex items-center">
      <i class="fas fa-shield-alt text-4xl mr-4 opacity-90"></i>
      <div>
        <h1 class="text-3xl font-bold">リスク管理ダッシュボード</h1>
        <p class="text-blue-200 text-lg">Company-wide Risk Overview & Management</p>
      </div>
    </div>
    <div class="flex items-center space-x-4">
      <div class="text-right">
        <p class="text-blue-200 text-sm">最終更新:</p>
        <p class="font-semibold">2025/06/10 14:00</p>
      </div>
      <button class="p-3 bg-blue-600 hover:bg-blue-500 rounded-full transition-colors">
        <i class="fas fa-sync-alt text-xl"></i>
      </button>
    </div>
  </header>

  <!-- Risk Selector and Overview -->
  <section class="mb-8 card p-6">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">全社リスク概要</h2>
      <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4 w-full md:w-auto">
        <select id="risk-selector" class="p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-700 w-full md:w-64">
          <option value="companyWide">全社リスク一覧</option>
          <option value="financialRisk">財務リスク</option>
          <option value="operationalRisk">運用リスク</option>
          <option value="systemRisk">システムリスク</option>
          <option value="marketRisk">市場リスク</option>
          <option value="legalRisk">法的リスク</option>
        </select>
        <button id="view-details-btn" class="px-5 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-md w-full md:w-auto">
          <i class="fas fa-info-circle mr-2"></i>リスク詳細表示
        </button>
      </div>
    </div>

    <div id="risk-info" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- KPIs for the selected risk view -->
      <div class="metric-box bg-gradient-to-br from-indigo-500 to-purple-600">
        <div class="z-10">
          <p class="text-sm opacity-90">総リスク件数</p>
          <p id="total-risk-count" class="text-3xl font-bold mt-1">58件</p>
        </div>
        <i class="fas fa-list-ul text-4xl opacity-50 ml-4"></i>
      </div>
      <div class="metric-box bg-gradient-to-br from-orange-500 to-red-600">
        <div class="z-10">
          <p class="text-sm opacity-90">対応中リスク</p>
          <p id="in-progress-risk-count" class="text-3xl font-bold mt-1">12件</p>
        </div>
        <i class="fas fa-hourglass-half text-4xl opacity-50 ml-4"></i>
      </div>
      <div class="metric-box bg-gradient-to-br from-green-500 to-teal-600">
        <div class="z-10">
          <p class="text-sm opacity-90">対応完了リスク</p>
          <p id="resolved-risk-count" class="text-3xl font-bold mt-1">40件</p>
        </div>
        <i class="fas fa-check-circle text-4xl opacity-50 ml-4"></i>
      </div>
      <div class="metric-box bg-gradient-to-br from-purple-500 to-pink-600">
        <div class="z-10">
          <p class="text-sm opacity-90">高重要度リスク</p>
          <p id="high-severity-risk-count" class="text-3xl font-bold mt-1">6件</p>
        </div>
        <i class="fas fa-exclamation-triangle text-4xl opacity-50 ml-4"></i>
      </div>
    </div>
  </section>

  <!-- Risk Trend Analysis and Severity Assessment -->
  <section class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
    <div class="xl:col-span-2 card p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-chart-area text-blue-600 mr-2"></i>
        リスク発生・対応状況推移 (月次)
      </h3>
      <div class="chart-container">
        <canvas id="riskTrendChart"></canvas>
      </div>
    </div>

    <div class="card p-6 flex flex-col items-center justify-center">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
        高リスク件数比率
      </h3>
      <div class="risk-gauge-container mb-4">
        <svg viewBox="0 0 160 160">
          <circle cx="80" cy="80" r="70" class="gauge-bg"></circle>
          <circle cx="80" cy="80" r="70" id="risk-gauge-fill" class="gauge-fill"
                  transform="rotate(-90 80 80)"></circle>
        </svg>
        <div id="risk-gauge-value" class="text-gauge-value text-red-600">15.0%</div>
        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 text-gray-600 text-sm">目標: 5%以下</div>
      </div>
      
      <div id="risk-assessment" class="risk-indicator risk-critical">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        リスク状況: 高 (緊急対応)
      </div>
      <p id="risk-recommendation" class="text-gray-600 text-sm mt-4 text-center">
        高重要度リスクが増加傾向にあります。緊急対応フローの確認とリソース配分を再検討してください。
      </p>
    </div>
  </section>

  <!-- Risk Breakdown and Mitigation -->
  <section class="grid grid-cols-1 lg:grid-cols-2-md gap-8 mb-8">
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-chart-pie text-orange-600 mr-2"></i>
        リスクカテゴリ別構成比
      </h3>
      <div class="chart-container">
        <canvas id="riskCategoryBreakdownChart"></canvas>
      </div>
    </div>

    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-clipboard-list text-red-600 mr-2"></i>
        主要リスクと推奨される対応
      </h3>
      <div class="space-y-4" id="key-risks-list">
        <!-- Key risks will be dynamically inserted here -->
        <div class="flex items-center justify-between p-4 rounded-lg bg-gray-50 border border-gray-200">
          <div class="flex-1">
            <span class="font-medium text-gray-700 block">サプライチェーン中断リスク</span>
            <span class="text-sm text-gray-500">責任部署: 調達部</span>
          </div>
          <span class="risk-indicator risk-medium ml-4">
            <i class="fas fa-minus mr-1"></i> 中
          </span>
        </div>
        <div class="flex items-center justify-between p-4 rounded-lg bg-gray-50 border border-gray-200">
          <div class="flex-1">
            <span class="font-medium text-gray-700 block">システム障害リスク</span>
            <span class="text-sm text-gray-500">責任部署: IT部</span>
          </div>
          <span class="risk-indicator risk-high ml-4">
            <i class="fas fa-arrow-up mr-1"></i> 高
          </span>
        </div>
      </div>
      
      <div class="mt-6 p-4 rounded-lg border-l-4 border-blue-500 bg-blue-50">
        <h4 class="font-bold text-blue-800 mb-2 flex items-center">
          <i class="fas fa-lightbulb text-blue-600 mr-2"></i>
          推奨施策:
        </h4>
        <ul id="recommendation-list" class="list-disc list-inside text-gray-700 text-sm space-y-1">
          <li>複数サプライヤーの確保、代替品調達ルートの確立。</li>
          <li>システムバックアップ体制の強化、定期的な災害復旧訓練の実施。</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Long-Term Risk Projection and Action Plan -->
  <section class="mb-8 card p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
      <i class="fas fa-chart-line text-purple-600 mr-2"></i>
      長期リスク予測 (10年間)
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="metric-box bg-gradient-to-br from-indigo-600 to-purple-700">
        <div class="z-10">
          <p class="text-sm opacity-90">予測総発生リスク件数</p>
          <p id="predicted-total-risks-10yr" class="text-3xl font-bold mt-1">0件</p>
        </div>
        <i class="fas fa-calculator text-4xl opacity-50 ml-4"></i>
      </div>
      <div class="metric-box bg-gradient-to-br from-red-600 to-pink-700">
        <div class="z-10">
          <p class="text-sm opacity-90">予測高重要度リスク件数</p>
          <p id="predicted-high-risks-10yr" class="text-3xl font-bold mt-1">0件</p>
        </div>
        <i class="fas fa-exclamation-triangle text-4xl opacity-50 ml-4"></i>
      </div>
      <div class="metric-box bg-gradient-to-br from-green-600 to-teal-700">
        <div class="z-10">
          <p class="text-sm opacity-90">予測削減率</p>
          <p id="predicted-reduction-rate-10yr" class="text-3xl font-bold mt-1">0%</p>
        </div>
        <i class="fas fa-arrow-down text-4xl opacity-50 ml-4"></i>
      </div>
    </div>

    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
      <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
      年間リスク発生推移 (10年間予測)
    </h3>
    <div class="chart-container">
      <canvas id="longTermRiskProjectionChart"></canvas>
    </div>
  </section>

  <!-- Action Plan Section -->
  <section class="grid grid-cols-1 xl:grid-cols-2 gap-8">
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-clipboard-list text-indigo-600 mr-2"></i>
        アクションプラン
      </h3>
      <ul class="list-disc list-inside text-gray-700 space-y-2">
        <li><strong>リスク評価ワークショップ:</strong> 定期的に全社的なリスク評価ワークショップを実施し、潜在的リスクを早期特定する。</li>
        <li><strong>リスク対応計画の策定と訓練:</strong> 各リスクに対する具体的な対応計画を策定し、定期的な訓練を実施する。</li>
        <li><strong>リスク監視体制の強化:</strong> リアルタイムのリスク監視ツールを導入し、異常検知時のアラートシステムを構築する。</li>
        <li><strong>ナレッジ共有とベストプラクティス:</strong> リスク対応事例や成功事例を全社で共有し、ベストプラクティスを確立する。</li>
      </ul>
      <div class="mt-6 p-4 rounded-lg bg-purple-50 border-l-4 border-purple-400">
        <p id="action-plan-summary" class="text-gray-700 text-sm">
          リスク対応状況は改善傾向にありますが、高重要度リスクへの迅速な対応が求められます。
        </p>
      </div>
    </div>

    <div class="card p-6 flex flex-col justify-between">
      <div>
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-cogs text-blue-600 mr-2"></i>
          関連ツール
        </h3>
        <ul class="list-disc list-inside text-gray-700 space-y-2">
          <li>**責任者設定:** リスク対応の責任者を明確にし、進捗を追跡します。</li>
          <li>**緊急対応フロー:** 緊急時に即座に実施できる対応手順を確認します。</li>
        </ul>
      </div>
      <div class="mt-6 flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
        <button class="px-5 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-md w-full">
          <i class="fas fa-file-alt mr-2"></i>リスクレポート出力
        </button>
        <button class="px-5 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md w-full">
          <i class="fas fa-rocket mr-2"></i>対応計画実行
        </button>
      </div>
    </div>
  </section>

  <!-- Notification Message Box -->
  <div id="notification-box" class="fixed bottom-6 right-6 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-xl hidden z-50 transform transition-all duration-300">
    <div class="flex items-center">
      <i id="notification-icon" class="mr-2"></i>
      <span id="notification-message"></span>
    </div>
  </div>

  <script>
    // Data for different risk categories
    const riskData = {
      companyWide: {
        name: "全社リスク一覧",
        kpis: {
          total: 58,
          inProgress: 12,
          resolved: 40,
          highSeverity: 6
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [8, 7, 9, 6, 8, 10, 9, 8, 7],
          resolvedRisks: [5, 6, 7, 7, 6, 8, 7, 6, 8],
          inProgressRisks: [15, 16, 18, 17, 19, 21, 23, 25, 24] // Cumulative for demonstration
        },
        severityRatio: 15.0, // Percentage of high severity risks
        severityAssessment: {
            status: 'critical', // Using a new 'critical' status for very high risk
            message: '高重要度リスクが増加傾向にあります。緊急対応フローの確認とリソース配分を再検討してください。',
            color: '#dc2626', // Deeper red for critical
            icon: 'fas fa-exclamation-triangle'
        },
        categoryBreakdown: {
          financial: 20,
          operational: 30,
          system: 25,
          market: 10,
          legal: 10,
          other: 5
        },
        keyRisks: [
          { name: 'サプライチェーン中断リスク', severity: 'medium', status: '対応中', department: '調達部' },
          { name: 'システム障害リスク', severity: 'high', status: '対応中', department: 'IT部' },
          { name: '個人情報漏洩リスク', severity: 'high', status: '未対応', department: '法務部' }
        ],
        recommendations: [
          '複数サプライヤーの確保、代替品調達ルートの確立。',
          'システムバックアップ体制の強化、定期的な災害復旧訓練の実施。',
          'データ保護ポリシーの徹底、従業員へのセキュリティ教育強化。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [80, 75, 70, 65, 60, 55, 50, 45, 40, 35], // Decreasing trend for effective management
            targetLevel: Array(10).fill(40) // Target to keep risks below a certain level
        },
        predictedTotalRisks10yr: 600, // Sum of predictedOccurrences
        predictedHighRisks10yr: 80, // Example value
        predictedReductionRate10yr: 30 // Example value, (initial - final) / initial * 100
      },
      financialRisk: {
        name: "財務リスク",
        kpis: {
          total: 10,
          inProgress: 3,
          resolved: 6,
          highSeverity: 1
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [2, 1, 1, 0, 1, 2, 1, 1, 0],
          resolvedRisks: [1, 1, 1, 1, 1, 1, 1, 1, 1],
          inProgressRisks: [5, 5, 5, 4, 4, 5, 5, 5, 4]
        },
        severityRatio: 10.0,
        severityAssessment: {
            status: 'medium',
            message: '為替変動リスクに注意が必要です。ヘッジ戦略の検討を推奨します。',
            color: '#f59e0b',
            icon: 'fas fa-exclamation-circle'
        },
        categoryBreakdown: {
          liquidity: 40,
          credit: 30,
          market: 20,
          operational: 10
        },
        keyRisks: [
          { name: '為替変動リスク', severity: 'medium', status: '対応中', department: '経理部' },
          { name: '資金繰りリスク', severity: 'low', status: '対応完了', department: '財務部' }
        ],
        recommendations: [
          '為替ヘッジ戦略の導入検討。',
          '運転資金の定期的な見直しと確保。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [15, 14, 13, 12, 11, 10, 9, 8, 7, 6],
            targetLevel: Array(10).fill(10)
        },
        predictedTotalRisks10yr: 100,
        predictedHighRisks10yr: 5,
        predictedReductionRate10yr: 20
      },
      operationalRisk: {
        name: "運用リスク",
        kpis: {
          total: 25,
          inProgress: 5,
          resolved: 18,
          highSeverity: 3
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [4, 3, 5, 4, 3, 4, 3, 4, 3],
          resolvedRisks: [3, 4, 3, 3, 4, 3, 4, 3, 4],
          inProgressRisks: [10, 9, 11, 12, 11, 12, 11, 12, 11]
        },
        severityRatio: 12.0,
        severityAssessment: {
            status: 'medium',
            message: '人的ミスによるリスクが散見されます。研修強化を推奨します。',
            color: '#f59e0b',
            icon: 'fas fa-exclamation-circle'
        },
        categoryBreakdown: {
          humanError: 45,
          processFailure: 30,
          externalEvents: 20,
          other: 5
        },
        keyRisks: [
          { name: '人的ミスによるデータ入力誤り', severity: 'medium', status: '対応中', department: '業務部' },
          { name: '業務プロセス遅延', severity: 'low', status: '対応完了', department: '企画部' }
        ],
        recommendations: [
          '従業員向けリスク管理研修の定期的な実施。',
          '業務プロセスの見直しと自動化の推進。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [30, 28, 25, 23, 20, 18, 16, 14, 12, 10],
            targetLevel: Array(10).fill(15)
        },
        predictedTotalRisks10yr: 200,
        predictedHighRisks10yr: 20,
        predictedReductionRate10yr: 50
      },
      systemRisk: {
        name: "システムリスク",
        kpis: {
          total: 15,
          inProgress: 4,
          resolved: 9,
          highSeverity: 2
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [3, 2, 2, 1, 3, 2, 1, 2, 1],
          resolvedRisks: [2, 1, 1, 2, 1, 2, 1, 1, 2],
          inProgressRisks: [8, 9, 10, 9, 10, 10, 9, 10, 9]
        },
        severityRatio: 13.3,
        severityAssessment: {
            status: 'medium',
            message: '外部からのサイバー攻撃リスクが高まっています。セキュリティ強化を急務とします。',
            color: '#f59e0b',
            icon: 'fas fa-exclamation-circle'
        },
        categoryBreakdown: {
          cyberSecurity: 50,
          dataLoss: 25,
          systemFailure: 20,
          other: 5
        },
        keyRisks: [
          { name: 'マルウェア感染リスク', severity: 'high', status: '対応中', department: 'IT部' },
          { name: 'データバックアップ未実施', severity: 'medium', status: '未対応', department: 'IT部' }
        ],
        recommendations: [
          '最新のセキュリティパッチ適用と脆弱性診断の定期実施。',
          'バックアップ体制の自動化と遠隔地保管の導入。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [20, 18, 16, 14, 12, 10, 9, 8, 7, 6],
            targetLevel: Array(10).fill(8)
        },
        predictedTotalRisks10yr: 107,
        predictedHighRisks10yr: 15,
        predictedReductionRate10yr: 40
      },
      marketRisk: {
        name: "市場リスク",
        kpis: {
          total: 5,
          inProgress: 1,
          resolved: 3,
          highSeverity: 0
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [0, 1, 0, 0, 1, 0, 0, 0, 0],
          resolvedRisks: [0, 0, 1, 0, 0, 1, 0, 0, 0],
          inProgressRisks: [2, 3, 2, 2, 3, 2, 2, 2, 2]
        },
        severityRatio: 0.0,
        severityAssessment: {
            status: 'low',
            message: '現時点での市場リスクは低いです。定期的な市場動向モニタリングを継続しましょう。',
            color: '#10b981',
            icon: 'fas fa-check-circle'
        },
        categoryBreakdown: {
          demandFluctuation: 60,
          competitorAction: 25,
          regulatoryChange: 10,
          other: 5
        },
        keyRisks: [
          { name: '競合企業の新サービス投入', severity: 'medium', status: '監視中', department: '企画部' }
        ],
        recommendations: [
          '市場トレンド分析の強化。',
          '競合動向の継続的な監視。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [5, 4, 4, 3, 3, 2, 2, 1, 1, 1],
            targetLevel: Array(10).fill(2)
        },
        predictedTotalRisks10yr: 26,
        predictedHighRisks10yr: 0,
        predictedReductionRate10yr: 60
      },
      legalRisk: {
        name: "法的リスク",
        kpis: {
          total: 3,
          inProgress: 1,
          resolved: 1,
          highSeverity: 1
        },
        monthlyTrend: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月予測', '8月予測', '9月予測'],
          newRisks: [0, 0, 1, 0, 0, 0, 0, 0, 0],
          resolvedRisks: [0, 0, 0, 0, 0, 0, 0, 0, 0],
          inProgressRisks: [1, 1, 2, 2, 2, 2, 2, 2, 2]
        },
        severityRatio: 33.3,
        severityAssessment: {
            status: 'high',
            message: '個人情報保護法改正への対応が遅れています。法務部門との連携を強化してください。',
            color: '#ef4444',
            icon: 'fas fa-times-circle'
        },
        categoryBreakdown: {
          compliance: 70,
          contract: 20,
          intellectualProperty: 10
        },
        keyRisks: [
          { name: '個人情報保護法違反リスク', severity: 'high', status: '未対応', department: '法務部' }
        ],
        recommendations: [
          '最新の法令遵守体制への更新。',
          '契約内容の定期的な法務チェック。'
        ],
        longTermProjection: {
            labels: Array.from({length: 10}, (_, i) => `Year ${i + 1}`),
            predictedOccurrences: [4, 4, 3, 3, 2, 2, 1, 1, 1, 1],
            targetLevel: Array(10).fill(1)
        },
        predictedTotalRisks10yr: 22,
        predictedHighRisks10yr: 8,
        predictedReductionRate10yr: 70
      }
    };

    let riskTrendChart;
    let riskCategoryBreakdownChart;
    let longTermRiskProjectionChart;

    // Initialize Charts on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      initializeCharts();
      updateRiskData('companyWide'); // Load initial data for "全社リスク一覧"
      setupEventListeners();
    });

    // Chart.js initialization function
    function initializeCharts() {
      // リスク発生・対応状況推移 (月次) Chart
      const rtCtx = document.getElementById('riskTrendChart').getContext('2d');
      riskTrendChart = new Chart(rtCtx, {
        type: 'line',
        data: {
          labels: [], // Populated dynamically
          datasets: [
            {
              label: '発生リスク',
              data: [],
              borderColor: '#3b82f6', // blue-500
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              tension: 0.3,
              fill: true,
              pointBackgroundColor: '#3b82f6',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 5
            },
            {
              label: '対応完了リスク',
              data: [],
              borderColor: '#10b981', // green-600
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.3,
              fill: true,
              pointBackgroundColor: '#10b981',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 5
            },
            {
              label: '対応中リスク',
              data: [],
              borderColor: '#f59e0b', // orange-500
              backgroundColor: 'rgba(245, 158, 11, 0.1)',
              tension: 0.3,
              fill: true,
              pointBackgroundColor: '#f59e0b',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 5
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                font: {
                  size: 14
                }
              }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return `${context.dataset.label}: ${context.raw}件`;
                    }
                }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '件数',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              ticks: {
                callback: function(value) {
                  return value + '件';
                }
              }
            },
            x: {
              title: {
                display: true,
                text: '期間',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              }
            }
          }
        }
      });

      // リスクカテゴリ別構成比 Chart
      const rcbCtx = document.getElementById('riskCategoryBreakdownChart').getContext('2d');
      riskCategoryBreakdownChart = new Chart(rcbCtx, {
        type: 'doughnut',
        data: {
          labels: [], // Populated dynamically
          datasets: [{
            data: [], // Populated dynamically
            backgroundColor: [
              '#3b82f6', // Financial - blue-500
              '#f59e0b', // Operational - orange-500
              '#ef4444', // System - red-500
              '#10b981', // Market - green-600
              '#a855f7', // Legal - purple-500
              '#eab308'  // Other - yellow-500
            ],
            hoverOffset: 10,
            borderWidth: 2,
            borderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                font: {
                  size: 14
                }
              }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        let label = context.label || '';
                        if (label) {
                            label += ': ';
                        }
                        label += context.raw + '%';
                        return label;
                    }
                }
            }
          }
        }
      });

      // 長期リスク予測 Chart
      const ltrpCtx = document.getElementById('longTermRiskProjectionChart').getContext('2d');
      longTermRiskProjectionChart = new Chart(ltrpCtx, {
        type: 'line',
        data: {
          labels: [], // Populated dynamically
          datasets: [
            {
              label: '予測されるリスク発生件数',
              data: [],
              borderColor: '#8b5cf6', // purple-500
              backgroundColor: 'rgba(139, 92, 246, 0.1)',
              tension: 0.3,
              fill: true,
              pointBackgroundColor: '#8b5cf6',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2,
              pointRadius: 5
            },
            {
              label: '目標リスクレベル',
              data: [],
              borderColor: '#22d3ee', // cyan-400
              backgroundColor: 'transparent',
              tension: 0,
              fill: false,
              borderDash: [5, 5], // Dashed line for target
              pointRadius: 0 // No points for target line
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                font: {
                  size: 14
                }
              }
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return `${context.dataset.label}: ${context.raw}件`;
                    }
                }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '件数',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              ticks: {
                callback: function(value) {
                  return value + '件';
                }
              }
            },
            x: {
              title: {
                display: true,
                text: '期間',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              }
            }
          }
        }
      });
    }

    // Update UI and charts with selected risk data
    function updateRiskData(riskId) {
      const data = riskData[riskId];
      if (!data) return;

      // Update KPI cards
      document.getElementById('total-risk-count').textContent = `${data.kpis.total}件`;
      document.getElementById('in-progress-risk-count').textContent = `${data.kpis.inProgress}件`;
      document.getElementById('resolved-risk-count').textContent = `${data.kpis.resolved}件`;
      document.getElementById('high-severity-risk-count').textContent = `${data.kpis.highSeverity}件`;
      
      // Update Risk Selector text for the selected option
      document.querySelector(`#risk-selector option[value="${riskId}"]`).textContent = data.name;

      // Update Risk Trend Chart (monthly view)
      riskTrendChart.data.labels = data.monthlyTrend.labels;
      riskTrendChart.data.datasets[0].data = data.monthlyTrend.newRisks;
      riskTrendChart.data.datasets[1].data = data.monthlyTrend.resolvedRisks;
      riskTrendChart.data.datasets[2].data = data.monthlyTrend.inProgressRisks;
      riskTrendChart.update();

      // Update Risk Gauge
      const riskGaugeFill = document.getElementById('risk-gauge-fill');
      const riskGaugeValue = document.getElementById('risk-gauge-value');
      const gaugeCircumference = 2 * Math.PI * 70; // 2 * pi * radius (radius is 70)
      const maxPercentage = 50; // Max percentage the gauge represents (e.g., up to 50% for high risk ratio)
      const percentage = Math.min(data.severityRatio, maxPercentage);
      const strokeDasharrayValue = (percentage / maxPercentage) * gaugeCircumference;
      riskGaugeFill.style.strokeDasharray = `${strokeDasharrayValue} ${gaugeCircumference}`;
      riskGaugeValue.textContent = `${data.severityRatio.toFixed(1)}%`;

      // Set gauge color and text color based on risk assessment
      const riskAssessmentElement = document.getElementById('risk-assessment');
      const riskRecommendationElement = document.getElementById('risk-recommendation');
      const severityAssessmentData = data.severityAssessment;

      riskGaugeFill.style.stroke = severityAssessmentData.color; // Set gauge fill color
      riskGaugeValue.style.color = severityAssessmentData.color; // Set gauge value text color

      // Update risk indicator class and content
      riskAssessmentElement.className = `risk-indicator ${getRiskClass(severityAssessmentData.status)}`;
      riskAssessmentElement.innerHTML = `<i class="${severityAssessmentData.icon} mr-2"></i>リスク状況: ${getRiskStatusText(severityAssessmentData.status)}`;
      riskRecommendationElement.textContent = severityAssessmentData.message;

      // Update Risk Category Breakdown Chart
      const categoryLabels = Object.keys(data.categoryBreakdown);
      const categoryValues = Object.values(data.categoryBreakdown);
      riskCategoryBreakdownChart.data.labels = categoryLabels;
      riskCategoryBreakdownChart.data.datasets[0].data = categoryValues;
      riskCategoryBreakdownChart.update();

      // Update Key Risks List
      const keyRisksList = document.getElementById('key-risks-list');
      keyRisksList.innerHTML = ''; // Clear previous content
      data.keyRisks.forEach(risk => {
        const riskItem = document.createElement('div');
        riskItem.className = 'flex items-center justify-between p-4 rounded-lg bg-gray-50 border border-gray-200';
        riskItem.innerHTML = `
          <div class="flex-1">
            <span class="font-medium text-gray-700 block">${risk.name}</span>
            <span class="text-sm text-gray-500">責任部署: ${risk.department}</span>
          </div>
          <span class="risk-indicator ${getRiskClass(risk.severity)} ml-4">
            <i class="${getRiskIcon(risk.severity)} mr-1"></i> ${getRiskText(risk.severity)}
          </span>
        `;
        keyRisksList.appendChild(riskItem);
      });

      // Update Recommendations
      const recommendationList = document.getElementById('recommendation-list');
      recommendationList.innerHTML = '';
      data.recommendations.forEach(rec => {
        const li = document.createElement('li');
        li.textContent = rec;
        recommendationList.appendChild(li);
      });

      // --- Update Long-Term Risk Projection Chart and KPIs ---
      longTermRiskProjectionChart.data.labels = data.longTermProjection.labels;
      longTermRiskProjectionChart.data.datasets[0].data = data.longTermProjection.predictedOccurrences;
      longTermRiskProjectionChart.data.datasets[1].data = data.longTermProjection.targetLevel;
      longTermRiskProjectionChart.update();

      // Update Long-Term Total KPIs
      document.getElementById('predicted-total-risks-10yr').textContent = `${data.predictedTotalRisks10yr}件`;
      document.getElementById('predicted-high-risks-10yr').textContent = `${data.predictedHighRisks10yr}件`;
      document.getElementById('predicted-reduction-rate-10yr').textContent = `${data.predictedReductionRate10yr}%`;
      
      // Update action plan summary
      document.getElementById('action-plan-summary').textContent = data.severityAssessment.message;

      showNotification(`${data.name} のデータが更新されました。`, 'success');
    }

    // Helper functions for risk assessment display
    function getRiskClass(riskLevel) {
      switch (riskLevel) {
        case 'high': return 'risk-high';
        case 'medium': return 'risk-medium';
        case 'low': return 'risk-low';
        case 'critical': return 'risk-critical'; // New critical class
        case '監視中': return 'risk-medium'; // For monitoring status
        case '対応中': return 'risk-medium';
        case '未対応': return 'risk-high';
        case '対応完了': return 'risk-low';
        default: return 'risk-low';
      }
    }

    function getRiskIcon(riskLevel) {
      switch (riskLevel) {
        case 'high': return 'fas fa-arrow-up';
        case 'medium': return 'fas fa-minus';
        case 'low': return 'fas fa-arrow-down';
        case 'critical': return 'fas fa-exclamation-triangle';
        case '監視中': return 'fas fa-eye';
        case '対応中': return 'fas fa-hourglass-half';
        case '未対応': return 'fas fa-times-circle';
        case '対応完了': return 'fas fa-check-circle';
        default: return 'fas fa-info-circle';
      }
    }

    function getRiskText(riskLevel) {
      switch (riskLevel) {
        case 'high': return '高';
        case 'medium': return '中';
        case 'low': return '低';
        case 'critical': return '緊急';
        case '監視中': return '監視中';
        case '対応中': return '対応中';
        case '未対応': return '未対応';
        case '対応完了': return '完了';
        default: return '不明';
      }
    }

    function getRiskStatusText(status) {
        switch (status) {
            case 'high': return '高 (要対策)';
            case 'medium': return '中 (監視)';
            case 'low': return '低 (正常)';
            case 'critical': return '高 (緊急対応)';
            default: return '不明';
        }
    }

    // Setup event listeners
    function setupEventListeners() {
      const riskSelector = document.getElementById('risk-selector');
      riskSelector.addEventListener('change', (event) => {
        updateRiskData(event.target.value);
      });

      const viewDetailsBtn = document.getElementById('view-details-btn');
      viewDetailsBtn.addEventListener('click', () => {
        const selectedRiskCategory = riskSelector.options[riskSelector.selectedIndex].text;
        showNotification(`${selectedRiskCategory} の詳細画面へ遷移します...`, 'info');
        // In a real Power Apps scenario, this would navigate to another screen
      });
      
      // Add event listeners for action buttons
      document.querySelector('.bg-indigo-600').addEventListener('click', () => {
          showNotification('リスクレポートを生成しています...', 'info');
          setTimeout(() => {
              showNotification('レポートが正常に生成されました！', 'success');
          }, 2000);
      });

      document.querySelector('.bg-green-600').addEventListener('click', () => {
          showNotification('対応計画を実行しています...', 'info');
          setTimeout(() => {
              showNotification('アクションが完了しました！', 'success');
          }, 2000);
      });

      document.querySelector('.fa-sync-alt').closest('button').addEventListener('click', () => {
          showNotification('データを更新しています...', 'info');
          setTimeout(() => {
              updateRiskData(riskSelector.value); // Re-load current data
              showNotification('データが最新になりました。', 'success');
          }, 1500);
      });
    }

    // Notification function
    function showNotification(message, type = 'info') {
        const notificationBox = document.getElementById('notification-box');
        const notificationMessage = document.getElementById('notification-message');
        const notificationIcon = document.getElementById('notification-icon');

        notificationMessage.textContent = message;

        // Reset classes
        notificationBox.classList.remove('bg-green-500', 'bg-blue-500', 'bg-yellow-500', 'bg-red-500', 'bg-gray-800');
        
        let iconClass = '';
        let bgColorClass = '';

        switch (type) {
            case 'success':
                bgColorClass = 'bg-green-500';
                iconClass = 'fas fa-check-circle';
                break;
            case 'info':
                bgColorClass = 'bg-blue-500';
                iconClass = 'fas fa-info-circle';
                break;
            case 'warning':
                bgColorClass = 'bg-yellow-500';
                iconClass = 'fas fa-exclamation-triangle';
                break;
            case 'error':
                bgColorClass = 'bg-red-500';
                iconClass = 'fas fa-times-circle';
                break;
            default:
                bgColorClass = 'bg-gray-800';
                iconClass = 'fas fa-info-circle';
        }
        notificationBox.classList.add(bgColorClass);
        
        notificationIcon.className = ''; // Clear existing icon classes
        iconClass.split(' ').forEach(cls => {
            if (cls) notificationIcon.classList.add(cls);
        });
        notificationIcon.classList.add('mr-2'); // Add margin-right separately

        notificationBox.classList.remove('hidden');
        notificationBox.style.transform = 'translateY(0) translateX(0)'; // Ensure it's visible

        setTimeout(() => {
            notificationBox.style.transform = 'translateY(120%) translateX(0)'; // Slide out
            setTimeout(() => {
                notificationBox.classList.add('hidden');
            }, 300); // Hide after animation
        }, 4000); // Display for 4 seconds
    }
  </script>
</body>
</html>
