<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>収益分析システム - エネルギーサービス企業</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px -3px rgba(0, 0, 0, 0.15);
    }
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .metric-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 1.5rem;
      color: white;
    }
    .metric-card.green {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    }
    .metric-card.orange {
      background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
    }
    .metric-card.red {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
    }
    .metric-card.purple {
      background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
    }
    .drill-down-item {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .drill-down-item:hover {
      background-color: #f3f4f6;
      padding-left: 1rem;
    }
    .chart-container {
      position: relative;
      height: 350px;
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .trend-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .trend-up {
      color: #10b981;
    }
    .trend-down {
      color: #ef4444;
    }
    .trend-flat {
      color: #6b7280;
    }
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .filter-chip {
      background: #e5e7eb;
      color: #374151;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .filter-chip.active {
      background: #3b82f6;
      color: white;
    }
    .filter-chip:hover {
      background: #d1d5db;
    }
    .filter-chip.active:hover {
      background: #2563eb;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-blue-50 min-h-screen">
  <!-- ヘッダーセクション -->
  <header class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white shadow-xl">
    <div class="container mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center">
          <div class="flex items-center mr-6">
            <i class="fas fa-chart-line text-2xl mr-3"></i>
            <div>
              <h1 class="text-2xl font-bold">収益分析システム</h1>
              <p class="text-blue-200 text-sm">Revenue Analysis Dashboard</p>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <span class="bg-blue-700 px-3 py-1 rounded-full text-sm font-medium">経営管理専用</span>
            <div class="text-center">
              <div class="text-xs text-blue-200">リアルタイム更新</div>
              <div class="text-lg font-bold text-white">2分前</div>
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <!-- 期間フィルター -->
          <div class="flex items-center space-x-2">
            <span class="text-sm text-blue-200">表示期間:</span>
            <select id="periodFilter" class="bg-blue-700 text-white rounded px-3 py-1 text-sm border border-blue-600">
              <option value="current_year">2025年度</option>
              <option value="last_year">2024年度</option>
              <option value="quarter">四半期比較</option>
              <option value="monthly">月次推移</option>
            </select>
          </div>
          <!-- 通知 -->
          <div class="relative">
            <button class="p-2 hover:bg-blue-700 rounded-full transition-colors">
              <i class="fas fa-bell text-xl"></i>
              <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">3</span>
            </button>
          </div>
          <!-- ユーザー情報 -->
          <div class="flex items-center space-x-3">
            <div class="text-right">
              <div class="font-semibold">中村 部長</div>
              <div class="text-sm text-blue-200">経営企画部</div>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-white to-gray-200 text-blue-800 rounded-full flex items-center justify-center font-bold text-lg">
              NK
            </div>
          </div>
          <button class="text-blue-200 hover:text-white text-sm">
            <i class="fas fa-cog mr-1"></i>設定
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-4 py-6">
    <!-- パンくずナビゲーション -->
    <nav class="flex items-center space-x-2 text-sm text-gray-600 mb-6">
      <a href="#" class="hover:text-blue-600 transition-colors flex items-center">
        <i class="fas fa-home mr-1"></i>
        ホーム
      </a>
      <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
      <a href="#" class="hover:text-blue-600 transition-colors">経営管理HUB</a>
      <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
      <span class="text-blue-600 font-semibold">収益分析</span>
    </nav>

    <!-- KPI概要 -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
      <!-- 売上高 -->
      <div class="metric-card card-hover">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
            <i class="fas fa-yen-sign text-white text-xl"></i>
          </div>
          <div class="trend-indicator trend-up">
            <i class="fas fa-arrow-up"></i>
            <span>+12.8%</span>
          </div>
        </div>
        <div class="text-3xl font-bold mb-1">¥2.84億</div>
        <div class="text-white text-opacity-80 text-sm">年間売上高</div>
        <div class="text-white text-opacity-60 text-xs mt-1">目標: ¥2.5億 (113.6%)</div>
      </div>

      <!-- 営業利益 -->
      <div class="metric-card green card-hover">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
            <i class="fas fa-chart-line text-white text-xl"></i>
          </div>
          <div class="trend-indicator trend-up">
            <i class="fas fa-arrow-up"></i>
            <span>+8.4%</span>
          </div>
        </div>
        <div class="text-3xl font-bold mb-1">¥0.35億</div>
        <div class="text-white text-opacity-80 text-sm">営業利益</div>
        <div class="text-white text-opacity-60 text-xs mt-1">利益率: 12.3% (+0.8%)</div>
      </div>

      <!-- 粗利率 -->
      <div class="metric-card orange card-hover">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
            <i class="fas fa-percentage text-white text-xl"></i>
          </div>
          <div class="trend-indicator trend-up">
            <i class="fas fa-arrow-up"></i>
            <span>+1.2%</span>
          </div>
        </div>
        <div class="text-3xl font-bold mb-1">28.5%</div>
        <div class="text-white text-opacity-80 text-sm">案件粗利率</div>
        <div class="text-white text-opacity-60 text-xs mt-1">前年: 27.3%</div>
      </div>

      <!-- ROI -->
      <div class="metric-card purple card-hover">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
            <i class="fas fa-bullseye text-white text-xl"></i>
          </div>
          <div class="trend-indicator trend-up">
            <i class="fas fa-arrow-up"></i>
            <span>+15.2%</span>
          </div>
        </div>
        <div class="text-3xl font-bold mb-1">18.7%</div>
        <div class="text-white text-opacity-80 text-sm">投資収益率</div>
        <div class="text-white text-opacity-60 text-xs mt-1">業界平均: 14.2%</div>
      </div>
    </div>

    <!-- フィルターとアクション -->
    <div class="bg-white rounded-2xl shadow-lg p-4 mb-6 card-hover">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex flex-wrap items-center gap-3">
          <span class="text-sm font-medium text-gray-700">分析フィルター:</span>
          <div class="flex flex-wrap gap-2">
            <span class="filter-chip active" data-filter="all">全体</span>
            <span class="filter-chip" data-filter="energy_service">エネルギーサービス</span>
            <span class="filter-chip" data-filter="power_sales">電力販売</span>
            <span class="filter-chip" data-filter="maintenance">保守・メンテナンス</span>
            <span class="filter-chip" data-filter="construction">工事案件</span>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors">
            <i class="fas fa-download mr-1"></i>レポート出力
          </button>
          <button class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-colors">
            <i class="fas fa-sync mr-1"></i>更新
          </button>
          <button class="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-colors">
            <i class="fas fa-cog mr-1"></i>カスタマイズ
          </button>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
      <!-- メインチャートエリア -->
      <div class="xl:col-span-2 space-y-6">
        
        <!-- 売上・利益推移グラフ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <i class="fas fa-chart-area text-blue-600 mr-2"></i>
              売上・利益推移分析
            </h3>
            <div class="flex items-center space-x-2">
              <select id="chartPeriod" class="text-sm border border-gray-300 rounded px-3 py-1">
                <option value="monthly">月次</option>
                <option value="quarterly">四半期</option>
                <option value="yearly">年次</option>
              </select>
              <button class="p-2 text-gray-500 hover:text-blue-600" title="ドリルダウン">
                <i class="fas fa-search-plus"></i>
              </button>
            </div>
          </div>
          
          <div class="chart-container">
            <canvas id="revenueChart"></canvas>
          </div>
          
          <!-- チャート補足情報 -->
          <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div class="text-center p-3 bg-blue-50 rounded-lg">
              <div class="font-bold text-blue-600">¥2.84億</div>
              <div class="text-gray-600">年間売上</div>
            </div>
            <div class="text-center p-3 bg-green-50 rounded-lg">
              <div class="font-bold text-green-600">¥0.35億</div>
              <div class="text-gray-600">営業利益</div>
            </div>
            <div class="text-center p-3 bg-orange-50 rounded-lg">
              <div class="font-bold text-orange-600">12.3%</div>
              <div class="text-gray-600">利益率</div>
            </div>
            <div class="text-center p-3 bg-purple-50 rounded-lg">
              <div class="font-bold text-purple-600">+12.8%</div>
              <div class="text-gray-600">前年比</div>
            </div>
          </div>
        </div>

        <!-- 部門別収益分析 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <i class="fas fa-building text-green-600 mr-2"></i>
              部門別収益分析
            </h3>
            <div class="flex items-center space-x-2">
              <span class="text-sm text-gray-500">表示:</span>
              <label class="flex items-center text-sm">
                <input type="radio" name="viewType" value="amount" checked class="mr-1">
                <span>金額</span>
              </label>
              <label class="flex items-center text-sm">
                <input type="radio" name="viewType" value="ratio" class="mr-1">
                <span>構成比</span>
              </label>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 部門別売上チャート -->
            <div class="chart-container">
              <canvas id="departmentChart"></canvas>
            </div>
            
            <!-- 部門別詳細 -->
            <div class="space-y-3">
              <h4 class="font-semibold text-gray-800 mb-3">部門別実績詳細</h4>
              
              <!-- エネルギーサービス部門 -->
              <div class="drill-down-item p-3 border border-gray-200 rounded-lg" data-department="energy_service">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                    <span class="font-medium">エネルギーサービス</span>
                  </div>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+18.2%</span>
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div>
                    <div class="font-bold text-blue-600">¥1.52億</div>
                    <div class="text-gray-500">売上</div>
                  </div>
                  <div>
                    <div class="font-bold text-green-600">¥0.21億</div>
                    <div class="text-gray-500">利益</div>
                  </div>
                  <div>
                    <div class="font-bold text-purple-600">13.8%</div>
                    <div class="text-gray-500">利益率</div>
                  </div>
                </div>
              </div>

              <!-- 電力販売部門 -->
              <div class="drill-down-item p-3 border border-gray-200 rounded-lg" data-department="power_sales">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span class="font-medium">電力販売</span>
                  </div>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+8.7%</span>
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div>
                    <div class="font-bold text-blue-600">¥0.89億</div>
                    <div class="text-gray-500">売上</div>
                  </div>
                  <div>
                    <div class="font-bold text-green-600">¥0.09億</div>
                    <div class="text-gray-500">利益</div>
                  </div>
                  <div>
                    <div class="font-bold text-purple-600">10.1%</div>
                    <div class="text-gray-500">利益率</div>
                  </div>
                </div>
              </div>

              <!-- 保守・メンテナンス部門 -->
              <div class="drill-down-item p-3 border border-gray-200 rounded-lg" data-department="maintenance">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                    <span class="font-medium">保守・メンテナンス</span>
                  </div>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+5.3%</span>
                  </div>
                </div>
                <div class="grid grid-cols-3 gap-2 text-sm">
                  <div>
                    <div class="font-bold text-blue-600">¥0.43億</div>
                    <div class="text-gray-500">売上</div>
                  </div>
                  <div>
                    <div class="font-bold text-green-600">¥0.05億</div>
                    <div class="text-gray-500">利益</div>
                  </div>
                  <div>
                    <div class="font-bold text-purple-600">11.6%</div>
                    <div class="text-gray-500">利益率</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 前年度比較・トレンド分析 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold text-gray-800 flex items-center">
              <i class="fas fa-chart-bar text-purple-600 mr-2"></i>
              前年度比較・トレンド分析
            </h3>
            <div class="flex items-center space-x-2">
              <button class="px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200" data-comparison="yoy">
                前年比較
              </button>
              <button class="px-3 py-1 bg-gray-100 text-gray-600 rounded text-sm hover:bg-gray-200" data-comparison="mom">
                前月比較
              </button>
              <button class="px-3 py-1 bg-gray-100 text-gray-600 rounded text-sm hover:bg-gray-200" data-comparison="qoq">
                前四半期比較
              </button>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 比較チャート -->
            <div class="chart-container">
              <canvas id="comparisonChart"></canvas>
            </div>
            
            <!-- トレンド分析 -->
            <div class="space-y-4">
              <h4 class="font-semibold text-gray-800">主要指標トレンド</h4>
              
              <!-- 売上トレンド -->
              <div class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-medium text-blue-800">売上高</span>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+12.8%</span>
                  </div>
                </div>
                <div class="text-2xl font-bold text-blue-600">¥2.84億</div>
                <div class="text-sm text-blue-600 mt-1">
                  前年同期: ¥2.52億 | 3ヶ月平均成長率: +4.2%
                </div>
              </div>

              <!-- 利益トレンド -->
              <div class="p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-medium text-green-800">営業利益</span>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+8.4%</span>
                  </div>
                </div>
                <div class="text-2xl font-bold text-green-600">¥0.35億</div>
                <div class="text-sm text-green-600 mt-1">
                  前年同期: ¥0.32億 | 利益率改善: +0.8%
                </div>
              </div>

              <!-- 効率性トレンド -->
              <div class="p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-medium text-purple-800">生産性指標</span>
                  <div class="trend-indicator trend-up">
                    <i class="fas fa-arrow-up"></i>
                    <span>+15.2%</span>
                  </div>
                </div>
                <div class="text-2xl font-bold text-purple-600">18.7%</div>
                <div class="text-sm text-purple-600 mt-1">
                  一人当たり売上: ¥2,840万 (+8.2%)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 右サイドバー -->
      <div class="xl:col-span-1 space-y-6">
        
        <!-- 予算達成率 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-bullseye text-green-600 mr-2"></i>
            予算達成状況
          </h3>
          
          <!-- 達成率ゲージ -->
          <div class="relative w-32 h-32 mx-auto mb-4">
            <canvas id="achievementGauge" width="128" height="128"></canvas>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
              <div class="text-2xl font-bold text-green-600">113.6%</div>
              <div class="text-xs text-gray-500">予算達成率</div>
            </div>
          </div>
          
          <div class="space-y-3 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">年間予算</span>
              <span class="font-medium">¥2.50億</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">実績</span>
              <span class="font-bold text-blue-600">¥2.84億</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">予算超過</span>
              <span class="font-bold text-green-600">¥0.34億</span>
            </div>
            <div class="border-t pt-2 flex justify-between">
              <span class="text-gray-600">残期間</span>
              <span class="font-medium">7ヶ月</span>
            </div>
          </div>
          
          <!-- 部門別達成率 -->
          <div class="mt-4 space-y-2">
            <h4 class="font-medium text-gray-800 text-sm">部門別達成率</h4>
            <div class="space-y-2">
              <div class="flex items-center justify-between text-sm">
                <span>エネルギーサービス</span>
                <div class="flex items-center">
                  <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                    <div class="h-2 bg-blue-500 rounded-full" style="width: 118%"></div>
                  </div>
                  <span class="font-bold text-blue-600">118%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>電力販売</span>
                <div class="flex items-center">
                  <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                    <div class="h-2 bg-green-500 rounded-full" style="width: 109%"></div>
                  </div>
                  <span class="font-bold text-green-600">109%</span>
                </div>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span>保守・メンテナンス</span>
                <div class="flex items-center">
                  <div class="w-16 h-2 bg-gray-200 rounded-full mr-2">
                    <div class="h-2 bg-orange-500 rounded-full" style="width: 105%"></div>
                  </div>
                  <span class="font-bold text-orange-600">105%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 収益性分析 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-chart-pie text-blue-600 mr-2"></i>
            収益性指標
          </h3>
          
          <div class="space-y-4">
            <!-- ROI -->
            <div class="p-3 bg-blue-50 rounded-lg">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm font-medium text-blue-800">投資収益率 (ROI)</span>
                <span class="text-xs text-blue-600">+15.2%</span>
              </div>
              <div class="text-xl font-bold text-blue-600">18.7%</div>
              <div class="text-xs text-blue-600">業界平均: 14.2%</div>
            </div>

            <!-- ROE -->
            <div class="p-3 bg-green-50 rounded-lg">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm font-medium text-green-800">自己資本利益率 (ROE)</span>
                <span class="text-xs text-green-600">+8.3%</span>
              </div>
              <div class="text-xl font-bold text-green-600">22.4%</div>
              <div class="text-xs text-green-600">前年同期: 20.7%</div>
            </div>

            <!-- EBITDA -->
            <div class="p-3 bg-purple-50 rounded-lg">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm font-medium text-purple-800">EBITDA</span>
                <span class="text-xs text-purple-600">+12.1%</span>
              </div>
              <div class="text-xl font-bold text-purple-600">¥0.42億</div>
              <div class="text-xs text-purple-600">EBITDA率: 14.8%</div>
            </div>

            <!-- 設備投資効率 -->
            <div class="p-3 bg-orange-50 rounded-lg">
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm font-medium text-orange-800">設備投資効率</span>
                <span class="text-xs text-orange-600">+6.2%</span>
              </div>
              <div class="text-xl font-bold text-orange-600">3.2倍</div>
              <div class="text-xs text-orange-600">投資額: ¥0.89億</div>
            </div>
          </div>
        </div>

        <!-- ドリルダウン分析 -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-search-plus text-purple-600 mr-2"></i>
            ドリルダウン分析
          </h3>
          
          <div class="space-y-3">
            <div class="p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 drill-down-item" data-drill="customer">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-sm">顧客別収益分析</div>
                  <div class="text-xs text-gray-500">上位10社で75%占有</div>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
              </div>
            </div>

            <div class="p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 drill-down-item" data-drill="project">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-sm">案件別収益分析</div>
                  <div class="text-xs text-gray-500">大型案件が収益を牽引</div>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
              </div>
            </div>

            <div class="p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 drill-down-item" data-drill="region">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-sm">地域別収益分析</div>
                  <div class="text-xs text-gray-500">九州エリアが主力</div>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
              </div>
            </div>

            <div class="p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 drill-down-item" data-drill="service">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-sm">サービス別収益分析</div>
                  <div class="text-xs text-gray-500">省エネサービスが好調</div>
                </div>
                <i class="fas fa-chevron-right text-gray-400"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- 予測・シミュレーション -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-crystal-ball text-indigo-600 mr-2"></i>
            予測・シミュレーション
          </h3>
          
          <div class="space-y-4">
            <!-- 年度末予測 -->
            <div class="p-4 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg">
              <h4 class="font-medium text-indigo-800 mb-2">年度末予測</h4>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-indigo-600">予測売上</span>
                  <span class="font-bold text-indigo-800">¥3.2億</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-indigo-600">予測利益</span>
                  <span class="font-bold text-indigo-800">¥0.42億</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-indigo-600">信頼度</span>
                  <span class="font-bold text-indigo-800">87%</span>
                </div>
              </div>
            </div>

            <!-- シナリオ分析 -->
            <div>
              <h4 class="font-medium text-gray-800 mb-3 text-sm">シナリオ分析</h4>
              <div class="space-y-2 text-sm">
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                  <span class="text-green-700">楽観シナリオ</span>
                  <span class="font-bold text-green-800">¥3.5億</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-blue-50 rounded">
                  <span class="text-blue-700">標準シナリオ</span>
                  <span class="font-bold text-blue-800">¥3.2億</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-orange-50 rounded">
                  <span class="text-orange-700">悲観シナリオ</span>
                  <span class="font-bold text-orange-800">¥2.9億</span>
                </div>
              </div>
            </div>

            <!-- アクション推奨 -->
            <div class="p-3 bg-yellow-50 border-l-4 border-yellow-400">
              <h4 class="font-medium text-yellow-800 mb-1 text-sm">推奨アクション</h4>
              <ul class="text-xs text-yellow-700 space-y-1">
                <li>• 大型案件の早期受注を推進</li>
                <li>• 高収益サービスの拡販強化</li>
                <li>• コスト構造の最適化検討</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- 詳細分析テーブル -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mt-6 card-hover">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-800 flex items-center">
          <i class="fas fa-table text-indigo-600 mr-2"></i>
          詳細収益分析テーブル
        </h3>
        <div class="flex items-center space-x-2">
          <button class="px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200">
            <i class="fas fa-filter mr-1"></i>フィルター
          </button>
          <button class="px-3 py-1 bg-green-100 text-green-600 rounded text-sm hover:bg-green-200">
            <i class="fas fa-download mr-1"></i>Excel出力
          </button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gray-50 border-b">
              <th class="text-left p-3 font-medium text-gray-700">部門</th>
              <th class="text-right p-3 font-medium text-gray-700">売上高</th>
              <th class="text-right p-3 font-medium text-gray-700">営業利益</th>
              <th class="text-right p-3 font-medium text-gray-700">利益率</th>
              <th class="text-right p-3 font-medium text-gray-700">前年比</th>
              <th class="text-center p-3 font-medium text-gray-700">予算達成</th>
              <th class="text-center p-3 font-medium text-gray-700">アクション</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b hover:bg-gray-50 cursor-pointer" data-department="energy_service">
              <td class="p-3">
                <div class="flex items-center">
                  <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                  <span class="font-medium">エネルギーサービス</span>
                </div>
              </td>
              <td class="p-3 text-right font-bold">¥152,000,000</td>
              <td class="p-3 text-right font-bold text-green-600">¥21,000,000</td>
              <td class="p-3 text-right font-bold">13.8%</td>
              <td class="p-3 text-right">
                <span class="trend-indicator trend-up">
                  <i class="fas fa-arrow-up"></i>
                  <span>+18.2%</span>
                </span>
              </td>
              <td class="p-3 text-center">
                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">118%</span>
              </td>
              <td class="p-3 text-center">
                <button class="text-blue-600 hover:text-blue-800">
                  <i class="fas fa-search-plus"></i>
                </button>
              </td>
            </tr>
            <tr class="border-b hover:bg-gray-50 cursor-pointer" data-department="power_sales">
              <td class="p-3">
                <div class="flex items-center">
                  <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                  <span class="font-medium">電力販売</span>
                </div>
              </td>
              <td class="p-3 text-right font-bold">¥89,000,000</td>
              <td class="p-3 text-right font-bold text-green-600">¥9,000,000</td>
              <td class="p-3 text-right font-bold">10.1%</td>
              <td class="p-3 text-right">
                <span class="trend-indicator trend-up">
                  <i class="fas fa-arrow-up"></i>
                  <span>+8.7%</span>
                </span>
              </td>
              <td class="p-3 text-center">
                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">109%</span>
              </td>
              <td class="p-3 text-center">
                <button class="text-blue-600 hover:text-blue-800">
                  <i class="fas fa-search-plus"></i>
                </button>
              </td>
            </tr>
            <tr class="border-b hover:bg-gray-50 cursor-pointer" data-department="maintenance">
              <td class="p-3">
                <div class="flex items-center">
                  <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                  <span class="font-medium">保守・メンテナンス</span>
                </div>
              </td>
              <td class="p-3 text-right font-bold">¥43,000,000</td>
              <td class="p-3 text-right font-bold text-green-600">¥5,000,000</td>
              <td class="p-3 text-right font-bold">11.6%</td>
              <td class="p-3 text-right">
                <span class="trend-indicator trend-up">
                  <i class="fas fa-arrow-up"></i>
                  <span>+5.3%</span>
                </span>
              </td>
              <td class="p-3 text-center">
                <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium">105%</span>
              </td>
              <td class="p-3 text-center">
                <button class="text-blue-600 hover:text-blue-800">
                  <i class="fas fa-search-plus"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="bg-gray-100 font-bold">
              <td class="p-3">合計</td>
              <td class="p-3 text-right text-blue-600">¥284,000,000</td>
              <td class="p-3 text-right text-green-600">¥35,000,000</td>
              <td class="p-3 text-right">12.3%</td>
              <td class="p-3 text-right">
                <span class="trend-indicator trend-up">
                  <i class="fas fa-arrow-up"></i>
                  <span>+12.8%</span>
                </span>
              </td>
              <td class="p-3 text-center">
                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">113.6%</span>
              </td>
              <td class="p-3 text-center">-</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      initializeCharts();
      addEventHandlers();
      animatePageLoad();
      
      // ウェルカムメッセージ
      setTimeout(() => {
        showNotification('収益分析システムが更新されました。最新データを表示中です。', 'success');
      }, 1000);
    });

    function initializeCharts() {
      // 売上・利益推移チャート
      const revenueCtx = document.getElementById('revenueChart').getContext('2d');
      new Chart(revenueCtx, {
        type: 'line',
        data: {
          labels: ['4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月', '1月', '2月', '3月'],
          datasets: [{
            label: '売上高 (千万円)',
            data: [18, 22, 25, 28, 24, 26, 23, 25, 27, 24, 22, 25],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y'
          }, {
            label: '営業利益 (千万円)',
            data: [2.2, 2.8, 3.1, 3.5, 2.9, 3.2, 2.7, 3.0, 3.3, 2.9, 2.6, 3.1],
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4,
            fill: true,
            yAxisID: 'y1'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.dataset.label + ': ' + context.parsed.y + (context.dataset.label.includes('売上') ? '千万円' : '千万円');
                }
              }
            }
          },
          scales: {
            x: {
              display: true,
              title: {
                display: true,
                text: '月度'
              }
            },
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: '売上高 (千万円)'
              },
              beginAtZero: true
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: '営業利益 (千万円)'
              },
              beginAtZero: true,
              grid: {
                drawOnChartArea: false,
              },
            }
          }
        }
      });

      // 部門別収益チャート
      const departmentCtx = document.getElementById('departmentChart').getContext('2d');
      new Chart(departmentCtx, {
        type: 'doughnut',
        data: {
          labels: ['エネルギーサービス', '電力販売', '保守・メンテナンス'],
          datasets: [{
            data: [152, 89, 43],
            backgroundColor: [
              'rgb(59, 130, 246)',
              'rgb(34, 197, 94)',
              'rgb(251, 146, 60)'
            ],
            borderWidth: 3,
            borderColor: '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((context.parsed / total) * 100).toFixed(1);
                  return context.label + ': ¥' + context.parsed + '百万 (' + percentage + '%)';
                }
              }
            }
          }
        }
      });

      // 前年度比較チャート
      const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
      new Chart(comparisonCtx, {
        type: 'bar',
        data: {
          labels: ['売上高', '営業利益', '粗利率', 'ROI'],
          datasets: [{
            label: '2024年度',
            data: [252, 32, 27.3, 16.2],
            backgroundColor: 'rgba(156, 163, 175, 0.8)',
            borderColor: 'rgb(156, 163, 175)',
            borderWidth: 1
          }, {
            label: '2025年度',
            data: [284, 35, 28.5, 18.7],
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgb(59, 130, 246)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '値'
              }
            }
          }
        }
      });

      // 予算達成率ゲージ
      const gaugeCtx = document.getElementById('achievementGauge').getContext('2d');
      const achievementRate = 113.6;
      const angle = (achievementRate / 150) * Math.PI; // 150%を最大とする

      gaugeCtx.lineWidth = 10;
      gaugeCtx.lineCap = 'round';

      // 背景円
      gaugeCtx.beginPath();
      gaugeCtx.arc(64, 64, 45, 0, Math.PI, false);
      gaugeCtx.strokeStyle = '#e5e7eb';
      gaugeCtx.stroke();

      // 達成率円
      gaugeCtx.beginPath();
      gaugeCtx.arc(64, 64, 45, Math.PI, Math.PI + angle, false);
      gaugeCtx.strokeStyle = achievementRate >= 100 ? '#10b981' : '#f59e0b';
      gaugeCtx.stroke();
    }

    function addEventHandlers() {
      // フィルターチップ
      const filterChips = document.querySelectorAll('.filter-chip');
      filterChips.forEach(chip => {
        chip.addEventListener('click', function() {
          filterChips.forEach(c => c.classList.remove('active'));
          this.classList.add('active');
          
          const filter = this.dataset.filter;
          showNotification(`フィルター適用: ${this.textContent}`, 'info');
          
          // フィルター処理をシミュレート
          setTimeout(() => {
            showNotification('データの更新が完了しました', 'success');
          }, 1500);
        });
      });

      // ドリルダウン項目
      const drillDownItems = document.querySelectorAll('.drill-down-item');
      drillDownItems.forEach(item => {
        item.addEventListener('click', function() {
          const type = this.dataset.drill || this.dataset.department;
          showNotification(`${type}の詳細分析を表示します`, 'info');
          
          // ドリルダウン処理をシミュレート
          this.style.backgroundColor = '#f3f4f6';
          setTimeout(() => {
            this.style.backgroundColor = '';
          }, 1000);
        });
      });

      // 期間フィルター
      const periodFilter = document.getElementById('periodFilter');
      periodFilter.addEventListener('change', function() {
        showNotification(`表示期間を${this.options[this.selectedIndex].text}に変更しています...`, 'info');
        
        // データ更新をシミュレート
        setTimeout(() => {
          showNotification('データの更新が完了しました', 'success');
        }, 2000);
      });

      // チャート期間選択
      const chartPeriod = document.getElementById('chartPeriod');
      chartPeriod.addEventListener('change', function() {
        showNotification(`チャート表示を${this.options[this.selectedIndex].text}に変更中...`, 'info');
      });

      // 比較ボタン
      const comparisonButtons = document.querySelectorAll('[data-comparison]');
      comparisonButtons.forEach(button => {
        button.addEventListener('click', function() {
          comparisonButtons.forEach(b => {
            b.classList.remove('bg-blue-100', 'text-blue-600');
            b.classList.add('bg-gray-100', 'text-gray-600');
          });
          
          this.classList.remove('bg-gray-100', 'text-gray-600');
          this.classList.add('bg-blue-100', 'text-blue-600');
          
          const comparison = this.dataset.comparison;
          showNotification(`${this.textContent}データを表示中...`, 'info');
        });
      });

      // レポート出力
      const reportButton = document.querySelector('button[title*="レポート"], .fa-download').closest('button');
      if (reportButton) {
        reportButton.addEventListener('click', function() {
          showNotification('収益分析レポートを生成しています...', 'info');
          
          setTimeout(() => {
            showNotification('レポートのダウンロードが完了しました', 'success');
          }, 3000);
        });
      }

      // 表の行クリック
      const tableRows = document.querySelectorAll('tbody tr[data-department]');
      tableRows.forEach(row => {
        row.addEventListener('click', function() {
          const department = this.dataset.department;
          showNotification(`${department}部門の詳細分析を表示します`, 'info');
          
          // 行のハイライト
          tableRows.forEach(r => r.classList.remove('bg-blue-50'));
          this.classList.add('bg-blue-50');
          
          setTimeout(() => {
            this.classList.remove('bg-blue-50');
          }, 2000);
        });
      });

      // ビューの切り替え（金額/構成比）
      const viewTypeRadios = document.querySelectorAll('input[name="viewType"]');
      viewTypeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          showNotification(`表示を${this.value === 'amount' ? '金額' : '構成比'}に切り替えています...`, 'info');
        });
      });

      // カスタマイズボタン
      const customizeButton = document.querySelector('.fa-cog').closest('button');
      if (customizeButton) {
        customizeButton.addEventListener('click', function() {
          showNotification('ダッシュボードカスタマイズ機能を開いています...', 'info');
        });
      }
    }

    function animatePageLoad() {
      const elements = document.querySelectorAll('.card-hover');
      elements.forEach((element, index) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          element.style.transition = 'all 0.3s ease';
          element.style.opacity = '1';
          element.style.transform = 'translateY(0)';
        }, index * 100);
      });

      // メトリックカードのカウントアップアニメーション
      const metricValues = document.querySelectorAll('.metric-card .text-3xl');
      metricValues.forEach(element => {
        const text = element.textContent;
        if (text.includes('¥')) {
          animateValue(element, 0, parseFloat(text.replace(/[¥億万]/g, '')), 1500, '¥', '億');
        } else if (text.includes('%')) {
          animateValue(element, 0, parseFloat(text.replace('%', '')), 1500, '', '%');
        }
      });
    }

    function animateValue(element, start, end, duration, prefix = '', suffix = '') {
      const startTime = performance.now();
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        const current = start + (end - start) * easeOutQuart(progress);
        element.textContent = prefix + current.toFixed(1) + suffix;
        
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      
      requestAnimationFrame(update);
    }

    function easeOutQuart(t) {
      return 1 - (--t) * t * t * t;
    }

    // 通知表示関数
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      const bgColor = {
        'success': 'bg-green-500',
        'warning': 'bg-yellow-500',
        'error': 'bg-red-500',
        'info': 'bg-blue-500'
      }[type] || 'bg-blue-500';
      
      const icon = {
        'success': 'fas fa-check',
        'warning': 'fas fa-exclamation-triangle',
        'error': 'fas fa-times',
        'info': 'fas fa-info-circle'
      }[type] || 'fas fa-info-circle';
      
      notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 max-w-md`;
      notification.innerHTML = `<i class="${icon} mr-2"></i>${message}`;
      notification.style.transform = 'translateX(100%)';
      
      document.body.appendChild(notification);
      
      // アニメーション
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // 自動削除
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 4000);
    }

    // リアルタイム更新シミュレーション
    function simulateRealTimeUpdate() {
      setInterval(() => {
        // ランダムにKPIを微調整
        const metrics = document.querySelectorAll('.metric-card .text-3xl');
        metrics.forEach(metric => {
          if (Math.random() > 0.95) { // 5%の確率で更新
            const text = metric.textContent;
            if (text.includes('¥')) {
              const value = parseFloat(text.replace(/[¥億万]/g, ''));
              const change = (Math.random() - 0.5) * 0.1; // ±5%の変動
              const newValue = (value * (1 + change)).toFixed(1);
              metric.textContent = `¥${newValue}億`;
              
              // 変更をハイライト
              metric.parentElement.style.animation = 'pulse 0.5s';
              setTimeout(() => {
                metric.parentElement.style.animation = '';
              }, 500);
            }
          }
        });
      }, 30000); // 30秒ごとに更新チェック
    }

    // ページ読み込み完了後にリアルタイム更新開始
    setTimeout(simulateRealTimeUpdate, 5000);

    // キーボードショートカット
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'r':
            e.preventDefault();
            showNotification('データを手動で更新しています...', 'info');
            setTimeout(() => {
              showNotification('データの更新が完了しました', 'success');
            }, 2000);
            break;
          case 'e':
            e.preventDefault();
            showNotification('Excel形式でデータをエクスポートしています...', 'info');
            break;
          case 'f':
            e.preventDefault();
            document.querySelector('.filter-chip[data-filter="all"]').click();
            break;
        }
      }
    });

    // ツールチップ機能
    function addTooltips() {
      const elements = document.querySelectorAll('[title]');
      elements.forEach(element => {
        element.addEventListener('mouseenter', function(e) {
          const tooltip = document.createElement('div');
          tooltip.className = 'absolute bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-lg z-50';
          tooltip.textContent = this.title;
          tooltip.style.left = e.pageX + 'px';
          tooltip.style.top = (e.pageY - 30) + 'px';
          document.body.appendChild(tooltip);
          
          this.tooltipElement = tooltip;
          this.title = ''; // 元のtitleを削除
        });
        
        element.addEventListener('mouseleave', function() {
          if (this.tooltipElement) {
            this.tooltipElement.remove();
            this.tooltipElement = null;
          }
        });
      });
    }

    // ツールチップ初期化
    setTimeout(addTooltips, 1000);

    // エラーハンドリング
    window.addEventListener('error', function(e) {
      console.error('JavaScript Error:', e.error);
      showNotification('システムエラーが発生しました。ページを再読み込みしてください。', 'error');
    });

    // パフォーマンス監視
    window.addEventListener('load', function() {
      const loadTime = performance.now();
      if (loadTime > 3000) {
        showNotification('ページの読み込みに時間がかかっています。ネットワーク接続をご確認ください。', 'warning');
      }
    });
  </script>
</body>
</html>